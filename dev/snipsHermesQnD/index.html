<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>SnipsHermesQnD · ADoSnipsTemplate</title><link rel="canonical" href="https://andreasdominik.github.io/ADoSnipsTemplate/dev/snipsHermesQnD/index.html"/><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="../index.html"><img class="logo" src="../assets/logo.svg" alt="ADoSnipsTemplate logo"/></a><h1>ADoSnipsTemplate</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Introduction</a></li><li class="current"><a class="toctext" href>SnipsHermesQnD</a><ul class="internal"><li><a class="toctext" href="#Julia-1">Julia</a></li><li><a class="toctext" href="#SnipsHermesQnD-1">SnipsHermesQnD</a></li><li><a class="toctext" href="#Template-skill-1">Template skill</a></li><li><a class="toctext" href="#SnipsHermesQnD-details-1">SnipsHermesQnD details</a></li></ul></li><li><a class="toctext" href="../makeskill/">New skill tutorial</a></li><li><a class="toctext" href="../api/api/">API Documentation</a></li><li><a class="toctext" href="../LICENSE/">License</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>SnipsHermesQnD</a></li></ul><a class="edit-page" href="https://github.com/andreasdominik/ADoSnipsTemplate/blob/master/docs/src/snipsHermesQnD.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>SnipsHermesQnD</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="The-SnipsHermesQnD-framework-1" href="#The-SnipsHermesQnD-framework-1">The SnipsHermesQnD framework</a></h1><h2><a class="nav-anchor" id="Julia-1" href="#Julia-1">Julia</a></h2><p>This template skill is (like the entire SnipsHermesQnD framework) written in the modern programming language Julia (because Julia is faster then Python and coding is much much easier and much more straight forward). However &quot;Pythonians&quot; often need some time to get familiar with Julia.</p><p>If you are ready for the step forward, start here: <a href="https://julialang.org/">https://julialang.org/</a></p><h3><a class="nav-anchor" id="Installation-of-Julia-language-1" href="#Installation-of-Julia-language-1">Installation of Julia language</a></h3><p>Installation of Julia is simple:</p><ul><li>just download the tar-ball for your architecture (most probably Raspberry-Pi/arm).</li><li>save it in an appropriate folder (<code>/opt/Julia/</code> might be a good idea).</li><li>unpack it: <code>tar -xvzf julia-&lt;version&gt;.tar.gz</code></li><li>make sure, that the julia executable is executable. You find it as <code>/opt/Julia/julia-&lt;version&gt;/bin/julia</code>. If it is not executable run <code>chmod 755 /opt/Julia/julia-&lt;version&gt;/bin/julia</code></li><li>Add a symbolic link from a location which is in the search path, such as <code>/usr/local/bin</code>:</li></ul><p>All together:</p><pre><code class="language-sh">sudo chown $(whoami) /opt    
mkdir /opt/Julia    
mv ~/Downloads/julia-&lt;version&gt;.tar.gz .    
tar -xvzf julia-&lt;version&gt;.tar.gz    
chmod 755 /opt/Julia/julia-&lt;version&gt;/bin/julia    
cd /usr/local/bin    
sudo ln -s /opt/Julia/julia-&lt;version&gt;/bin/julia    </code></pre><p><strong>... and you are done!</strong></p><p>For a very quick <em>get into,</em> see   <a href="http://learnxinyminutes.com/docs/julia/">learn Julia in Y minutes</a>.</p><h3><a class="nav-anchor" id="IDEs-1" href="#IDEs-1">IDEs</a></h3><p>Softwarte development is made comfortable by IDEs (Integrated Development Environements). For Julia, best choices include:</p><ul><li>My favourite is the <a href="http://atom.io/">Atom editor</a> with the <a href="http://junolab.org">Juno package</a> installed.</li><li><a href="https://code.visualstudio.com">Visual Studio Code</a> also provides very good support for Julia.</li><li>Playing around and learning is best done with <a href="http://jupyter.org">Jupyter notebooks</a>. The Jupyter stack can be installed easily from the Julia REPL by adding the Package <code>IJulia</code>.</li></ul><h3><a class="nav-anchor" id="Noteworthy-differences-between-Julia-and-Python-1" href="#Noteworthy-differences-between-Julia-and-Python-1">Noteworthy differences between Julia and Python</a></h3><p>Julia code looks very much like Python code, except of</p><ul><li>there are no colons,</li><li>whitespaces have no meaning; blocks end with an <code>end</code>,</li><li>sometimes types should be given explicitly.</li></ul><p>However Julia a typed language with all advantages; and code is run-time-compiled only once, with consequences:</p><ul><li>If a function is called for the first time, there is a time lack, because the compiler must finish his work before the actual code is executed.</li><li>Future function calls will use the compiled program, making Julia code execute as fast as compiled C-code!</li></ul><h2><a class="nav-anchor" id="SnipsHermesQnD-1" href="#SnipsHermesQnD-1">SnipsHermesQnD</a></h2><p>The framework SnipsHermesQnD is currently not distributed as an individual package, because it is work-in-progress and will change continuously. In order to be sure, that existing skills/apps are not effected by changes of the framework, every skill brings its own version of SnipsHermesQnD with it.</p><p>At some point in the future (when the framework is in a released state) this might change. But still existing skills will work.</p><h3><a class="nav-anchor" id="Installation-of-the-framework-1" href="#Installation-of-the-framework-1">Installation of the framework</a></h3><p>The framework needs not to be installed, because it is distributed with each skill (see above). However <code>Eclipse modquitto</code> must be installed. On a Raspberry Pi the packages <code>mosquitto</code> and <code>mosquitto-clients</code> are needed:</p><pre><code class="language-sh">sudo apt-get install mosquitto
sudo apt-get install mosquitto-clients</code></pre><p>To use skills developped with SnipsHermesQnD just add the ADoSnipsHermesQnD App to your assistant. There are versions in German and English language (<code>ADoSnipsHermesQnD_DE</code> and <code>ADoSnipsHermesQnD_EN</code>)</p><h2><a class="nav-anchor" id="Template-skill-1" href="#Template-skill-1">Template skill</a></h2><p>The template <code>ADosnipsTemplate</code> is already a fully functional skill. To test it, just add the ADoSnipsTemplate-skill to your assistant in the Snips console and update your assistant with sam (<code>sam update-assistant</code>). The skill is available in English and German and shows how the multi-language support of the framework works.</p><p>During installation with <code>sam</code> you will be asked to confirm the settings in <code>config.ini</code>.</p><ul><li>Please set the language to the laguage you need (currently <code>en</code> and <code>de</code> are supported)</li><li>Please give your assistant a name. The Skill will repeat the name, when activated in order to show the code necessary to access <code>config.ini</code> values.</li></ul><p>The Template Skill includes the intent <code>pleaseRepeat</code> (as <code>pleaseRepeatDE</code> and <code>pleaseRepeatEN</code>) which allows to say things like:</p><pre><code class="language-Julia">&quot;please repeat the word holydays&quot;
&quot;please say: movie&quot;
...</code></pre><p>or in German:</p><pre><code class="language-Julia">&quot;Bitte sprich mit nach: Auto&quot;
&quot;Bitte sage: Kaffeemaschine&quot;
...</code></pre><p>The app will repeat the word.</p><h2><a class="nav-anchor" id="SnipsHermesQnD-details-1" href="#SnipsHermesQnD-details-1">SnipsHermesQnD details</a></h2><h3><a class="nav-anchor" id="Strategy-1" href="#Strategy-1">Strategy</a></h3><p>The idea behind the framework is, to put as much as possible in the background so that a developper only needs to provide the code for the functions executed for an intent.</p><p>The MQTT-messages of <em>Hermes</em> and the <em>Dialogue Manager</em> are wrapped, but additional interfaces to <em>Hermes</em> are provided to enable direct dialogues without using callbacks.</p><p>In addion background information, such as current session-ID or current site-ID are mostly handled in the background and not exposed to a skill developper.</p><p>Additional utilities are provided to</p><ul><li>read values from intent slots</li><li>read values from <code>config.ini</code></li><li>write apps for more then one language</li><li>get an answer form the NLU back as function value in the control flow of a function</li><li>use a global intent for switching a device on or off</li><li>let Snips ask a question and get &quot;yes&quot; or &quot;no&quot; back as boolean value</li><li>let Snips continue a conversation without the need to utter the hotword again.</li></ul><h3><a class="nav-anchor" id="Common-intent-for-on/off-1" href="#Common-intent-for-on/off-1">Common intent for on/off</a></h3><p>The on/off-intent, integrated with the SnipsHermesQnD framework, allows for writing apps to power up or down devices, without the need to create a new intent for every device.</p><p>Background: All home assistants run into problems when many intents are responsible to switch on or off a device. Obviously all these intends are very similar and it is not easy to always detect the correct intent and device.</p><p>SnipsHermesQnD tries to work around this issue, by using only one intent for all on/off-commands.</p><p>All supported devices are listed in the slot <code>device</code> of the intent <code>AdoSnipsOnOff&lt;EN/DE&gt;</code> and defined in the slot type <code>device_Type</code>.</p><p>The app <code>ADoSnipsHermesQnD</code> has some code behind to handle unrecognised devises. The associated <code>config.ini</code> defines a list of unhandled devices. If you want to use the intent to swich an additional device on or off</p><ul><li>firstly look in the config.ini, if the device is already defined and in the list of unhandled devices. In this case just remove it from the list, and the your code will be executed if the command is recognised.</li><li>secondly, if the new device is not already in the list, you will have to create a fork of the intent and add a new device to the values of the slot type <code>device_Type</code>.</li></ul><p>The framework comes with a function <code>isOnOffMatched(payload, DEVICE_NAME)</code> which can be called with the current payload and the name (and optionally with the siteId) of the device of interest. It will return one of</p><ul><li><code>:on</code>, if an &quot;ON&quot; is recognised for the device</li><li><code>:off</code>, if an &quot;OFF&quot; is recognised for the device</li><li><code>:matched</code>, if the device is recognised but no specific on or off</li><li><code>:unmatched</code>, if the device is not recognised.</li></ul><p>The tutorial shows a simple example how to use this functionality.</p><h3><a class="nav-anchor" id="Ask-and-answer-Yes-or-No-1" href="#Ask-and-answer-Yes-or-No-1">Ask and answer Yes-or-No</a></h3><p>An often needed functionality is a quick confirmation feedback of the user. This is provided by the framework function <code>askYesOrNo(question)</code>.</p><p>See the following self-exlpaining code as example:</p><pre><code class="language-Julia">&quot;&quot;&quot;
function destroyAction(topic, payload)

    Initialise self-destruction.
&quot;&quot;&quot;
function destroyAction(topic, payload)

  # log message:
  println(&quot;- ADoSnipsDestroyYourself: action destroyAction() started.&quot;)

  if askYesOrNo(&quot;Do you really want to initiate self-destruction?&quot;)
    Snips.publishEndSession(&quot;Self-destruction sequence started!&quot;)
    boom()
  else
    Snips.publishEndSession(&quot;&quot;&quot;OK.
                            Self-destruction sequence is aborted!
                            Live long and in peace.&quot;&quot;&quot;)
  end

  return true
end</code></pre><p>The intent to capture the user response comes with the framework and is activated just for this dialogue.</p><h3><a class="nav-anchor" id="Continue-conversation-without-hotword-1" href="#Continue-conversation-without-hotword-1">Continue conversation without hotword</a></h3><p>Sometimes it is necessary to control a device with a sequence of several comands. In this case it is not natural to speak the hotword everytime. like:</p><p><em>hey Snips</em></p><p><em>switch on the light</em></p><p><em>hey Snips</em></p><p><em>dim the light</em></p><p><em>hey Snips</em></p><p><em>dim the light again</em></p><p><em>hey Snips</em></p><p><em>dim the light again</em>    </p><p>Instead, we want something like:</p><p><em>hey Snips</em></p><p><em>switch on the light</em></p><p><em>dim the light</em></p><p><em>dim the light again</em></p><p><em>dim the light again</em>    </p><p>This can be achieved by starting a new session just after an intent is processed. In the SnipsHermesQnD framework this is controlled by two mechanisms:</p><p>The <code>config.jl</code> defines a constant <code>const CONTINUE_WO_HOTWORD = true</code>. <code>true</code> is the default and hence continuation without hotword is enabled by default. To completely disable it for your skill, just set the constant to <code>false</code>.     The second mechanism is the return value of every single skill-action. A new session will only be started if both are true, the constant <code>CONTINUE_WO_HOTWORD</code> and the return value of the function. This way it is possible to decide for each action individually, if a hotword is required for the next command.</p><h3><a class="nav-anchor" id="Multi-language-support-1" href="#Multi-language-support-1">Multi-language support</a></h3><p>Multi-language skills need to be able to switch between laguages. In the context of Snips this requires special handling in two cases:</p><ul><li>All text, uttered by the assistant must be defined in all languages.</li><li>An intent is always tied to one language. Therefore for multi-language skills similar intents (with the same slots) must be created for each supported language.</li></ul><p>Multi-language support ist added in 4 steps:</p><h4><a class="nav-anchor" id=")-Define-language-in-config.ini:-1" href="#)-Define-language-in-config.ini:-1">1) Define language in config.ini:</a></h4><p>The <code>config.ini</code> must have a line like:</p><pre><code class="language-Julia">language=en</code></pre><h4><a class="nav-anchor" id=")-Define-the-texts-in-all-languages:-1" href="#)-Define-the-texts-in-all-languages:-1">2) Define the texts in all languages:</a></h4><p>To let Snips speak different languages, all texts must be defined in a Dictionary with unique keys. These are defined in the file <code>languages.jl</code>, as shown in the Template:</p><pre><code class="language-Julia">TEXTS_DE = Dict(
:iam =&gt; &quot;Ich bin dein Assistent $myName und ich soll sagen $word&quot;,
:bravo =&gt; &quot;Bravo, du hast erfolgreich das Template installiert!&quot;,
:noname =&gt; &quot;Ich finde keinen Namen in der config Datei!&quot;,
:dunno =&gt; &quot;Ich habe nicht verstanden was ich sagen soll!&quot;
)

TEXTS_EN = Dict(
:iam =&gt; &quot;I am yor home assistant $myName and you told me to say $word&quot;,
:bravo =&gt; &quot;Bravo, you managed to install the template!&quot;,
:noname =&gt; &quot;My name is not configured in the config file!&quot;,
:dunno =&gt; &quot;I did not catch what you want me to say!&quot;
)</code></pre><h4><a class="nav-anchor" id=")-Create-similar-intents-for-all-languages:-1" href="#)-Create-similar-intents-for-all-languages:-1">3) Create similar intents for all languages:</a></h4><p>The most time-consuming step ist to create the intents in the Snips console - however this is necessary, because speach-to-text as well as natural language understanding highly depend on the language.</p><h4><a class="nav-anchor" id=")-Switch-between-languages:-1" href="#)-Switch-between-languages:-1">4) Switch between languages:</a></h4><p>The <code>config.jl</code> of the template app shows how switching languages is possible within SnipsHermesQnD:</p><pre><code class="language-Julia">const LANG = Snips.getIniLanguage() != nothing ? Snips.getIniLanguage() : &quot;en&quot;

...

if LANG == &quot;de&quot;
    INTENT_ACTIONS = INTENT_ACTIONS_DE
    TEXTS = TEXTS_DE
elseif LANG == &quot;en&quot;
    INTENT_ACTIONS = INTENT_ACTIONS_EN
    TEXTS = TEXTS_EN
else
    INTENT_ACTIONS = INTENT_ACTIONS_EN
    TEXTS = TEXTS_EN
end</code></pre><p>The first line tries to read the language from <code>config.ini</code> and sets it to the default if no definition is found.</p><p>The latter part selects the intents and texts to be used. A dictionary of texts is necessary for each language and a dictionary of intents is necessary for each language.</p><footer><hr/><a class="previous" href="../"><span class="direction">Previous</span><span class="title">Introduction</span></a><a class="next" href="../makeskill/"><span class="direction">Next</span><span class="title">New skill tutorial</span></a></footer></article></body></html>
